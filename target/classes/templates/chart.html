<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>My Consumption</title>
    <link rel='icon'href="images/icon.png">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="css/style.css">

</head>
<body>
<nav>
    <div class="container">
        <div class="logo">
            <img src="images/Blue_logo.png" alt="logoo"/>
            <br>
            <br>
            <h4><font color="#64bcf4">Next Generation Smart Grid Meter (NGSM)</font></h4>
        </div>

        <div class="links">
            <ul>
                <li>
                    <a href="/index">Home</a>
                </li>
                <li>
                    <a href="/FAQs">FAQs</a>
                </li>
                <li>
                    <a href="/pricing">Pricing</a>
                </li>
                <li><a href="/me/bill">Bill</a></li>

                <li>
                    <div id="logoutDiv">
                        <form action="#" th:action="@{/logout}"method="POST">
                            <button type="submit" class="btn btn-secondary float-right" id="logout-btn">Logout</button>
                        </form>
                    </div>
                </li>
            </ul>
        </div>

        <div class="hamburger-menu">
            <div class="bar"></div>
        </div>
    </div>
</nav>
<hr>
<div class="header-content">
    <div class="container grid-2">
        <div class="column-1">
            <h1 class="header-title">choose the date</h1>
            <table>
                <tr>
                    <td colspan="2"><p><font color="white">Please, Choose a start date and end date to view your consumption: </font></p></td>
                </tr>
                <tr>
                    <td><font color="black"><p>Start date : </p></font></td>
                    <td><input class="calender" type="date" id="date-picker-start"></td>
                </tr>
                <br>
                <br>
                <tr>
                    <td><font color="black"><p>End date : </p></font></td>
                    <td><input class="calender" type="date" id="date-picker-end"></td>
                </tr>
                <br>
                <tr >
                    <td colspan="3"><button  class="btn" onclick="sendRequest()">Show my Consumption</button></td>
                </tr>
            </table>

        </div>


        <div class="rightpart">

            <div class="card-header">
                <h2>My Chart</h2>
            </div>
            <canvas id="myChart"></canvas>


        </div>
    </div>
</div>
<!--<div class="showcase-area">
    <div class="container">
                <div class="leftpart">
                    <div class="big-title">
                        <h1>Choose the date.</h1>
                    </div>
                    <table>
                        <tr>
                            <td colspan="2"><p><font color="white">Please, Choose a start date and end date to view your consumption: </font></p></td>
                        </tr>
                        <tr>
                            <td><font color="black"><p>Start date : </p></font></td>
                            <td><input class="calender" type="date" id="date-picker-start"></td>
                        </tr>
                       <br>
                       <br>
                        <tr>
                            <td><font color="black"><p>End date : </p></font></td>
                            <td><input class="calender" type="date" id="date-picker-end"></td>
                        </tr>
                        <br>
                        <tr >
                            <td colspan="3"><button  class="btn" onclick="sendRequest()">Show my Consumption</button></td>
                        </tr>
                    </table>

                </div>


                <div class="rightpart">
                    <div class="card text-center m-5">
                        <div class="card-header">
                            <h2>My Chart</h2>
                        </div>
                        <canvas id="myChart"></canvas>
                    </div>
                </div>
            </div>
        </div>-->
<!-----------------------------------------------------------Chart----------------------------------------->
<!--  <div class="card text-center m-5">
   <div class="card-header">
       <h2>My Chart</h2>
   </div>
   <canvas id="myChart"></canvas>
</div>

<footer>
   <div class="footer-content">
       <h3>Next Generation Smart Grid Meter</h3>
       <p>Electricity can transform people's lives, not just economically but also socially</p>
       <ul class="socials">
           <li><a href="https://www.facebook.com/ElsewedyElectric/"><i class="fa fa-facebook"></i></a></li>
           <li><a href="#"><i class="fa fa-twitter"></i></a></li>
           <li><a href="#"><i class="fa fa-youtube"></i></a></li>
           <li><a href="#"><i class="fa fa-linkedin-square"></i></a></li>
       </ul>
   </div>
   <div class="footer-bottom">
       <p>copyright &copy; 2022 ElSewedy Electric</p>
   </div>
</footer>
-->
<footer class="footer">
    <div class="container">
        <div class="grid-4">
            <div class="grid-4-col footer-about">
                <h3 class="title-sm">About</h3>
                <p class="text">
                    Our beginnings as a manufacturer of electrical components in Egypt 80 years ago
                </p>
            </div>

            <div class="grid-4-col footer-links">
                <h3 class="title-sm">Links</h3>
                <ul>
                    <li>
                        <a href="#services">About Us</a>
                    </li>
                    <li>
                        <a href="#portfolio">Pricing</a>
                    </li>
                    <li>
                        <a href="#contact">Login</a>
                    </li>
                </ul>
            </div>

            <div class="grid-4-col footer-links">
                <h3 class="title-sm">Services</h3>
                <ul>
                    <li>
                        <a href="#">Web Development</a>
                    </li>
                    <li>
                        <a href="#">Mobile Development</a>
                    </li>
                    <li>
                        <a href="#">Machine Learning</a>
                    </li>
                    <li>
                        <a href="#">Embedded Linux</a>
                    </li>
                </ul>
            </div>

            <div class="grid-4-col footer-newstletter">
                <h3 class="title-sm">Contact Us</h3>

                <div class="footer-input-wrap">
                    <input type="email" class="footer-input" placeholder="Email" />
                    <a href="#" class="input-arrow">
                        <i class="fas fa-angle-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="bottom-footer">
            <div class="copyright">
                <p class="text">
                    Copyright&copy;2020 All rights reserved | Made by
                    <span>/ root</span>
                </p>
            </div>

            <div class="followme-wrap">
                <div class="followme">
                    <h3>Follow Us</h3>
                    <span class="footer-line"></span>
                    <div class="social-media">
                        <a href="#">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>

                <div class="back-btn-wrap">
                    <a href="#" class="back-btn">
                        <i class="fas fa-chevron-up"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script>
       var employeelabel = [], employeesalary = [], employeeage = [];
       var start_global;
       var end_global;
         async function dummyChart(){

            await getdata();
            let ctx = document.getElementById('myChart').getContext('2d');
            let chart =new Chart(ctx,{
            type:'bar',
            data:{
                labels:employeelabel,
                datasets:[{
                label:'My amount for this day',
                backgroundColor:'#6FB2D2',
                borderColor:'#6FB2D2',
                data: employeesalary,
                },
                {
                label:'My consumed energy for this day',
                backgroundColor:'#fa8c7f',
                borderColor:'#fa8c7f',
                data:employeeage,
                }
            ]
            },
            options:{
                tooltip:{
                    mode: 'index'
                }
            }
        });
    }
        async function getdata(){

          const apiurl = 'https://rooot.azurewebsites.net/reading/get/period?userId=30&start='+start_global+'&end='+end_global;
            const response = await fetch(apiurl);
            const barChartData = await response.json();

            const salary = barChartData.map( (x) => x.amount);
            const age = barChartData.map( (x) => x.energy);
            const day = barChartData.map( (x) => x.date);

            console.log(salary,age,day);

            employeelabel = day;
            employeesalary = salary;
            employeeage = age;

            }
            function sendRequest(){
              populateDate();     //dates: [start, end]
              dummyChart();

            }
            function populateDate(){
                var start = new Date(document.getElementById("date-picker-start").value);
                var year = start.getFullYear();
                var month = start.getMonth()+1;
                if(month<9) month = '0'+month;
                var day = String(start.getDate()).padStart(2,'0');
                var startDate = year + '-' + month + '-' + day;

                var end = new Date(document.getElementById("date-picker-end").value);
                year = start.getFullYear();
                month = start.getMonth()+1;
                if(month<9) month = '0'+month;

                day = String(end.getDate()).padStart(2,'0');
                var endDate = year + '-' + month + '-' + day;

                start_global = startDate;
                end_global = endDate;
                console.log(start_global);
              }

    </script>
<script src="https://unpkg.com/aos@next/dist/aos.js"> </script>
<script>
        AOS.init({
            duration:1000
        });
    </script>


</body>
</html>